
<style>
  /* Collapsible tag filter polish */
  #tagFilters .tag-grid{
    max-height: 260px;
    overflow: auto;
    padding-right: 6px;
  }
</style>

{% extends "portal/base.html" %}
{% block title %}Browse Proposals | MSRIG{% endblock %}

{% block content %}

<!-- HERO -->
<section class="hero">
  <div class="container">
    <div class="row justify-content-center text-center">
      <div class="col-lg-9">
        <h1 class="display-6 mb-3">Find a project. Join a team. Earn authorship.</h1>
        <p class="lead mb-4">
          Browse student-led research ideas and sign up to help. Build experience, publications, and connections.
        </p>

        <div class="d-flex gap-2 justify-content-center flex-wrap">
          <a class="btn btn-gold" href="{% url 'home' %}">Browse Proposals</a>
          <a class="btn btn-outline-light" href="{% url 'proposal_create' %}" style="font-weight:800;border-radius:12px;padding:10px 18px;">
            Submit a Proposal
          </a>
        </div>

        <!-- MSRIG Callout -->
        <div class="mt-4 mx-auto" style="max-width: 820px;">
          <div class="p-3 p-md-4" style="background: rgba(255,255,255,.12); border: 1px solid rgba(255,255,255,.18); border-radius: 16px;">
            <div class="d-flex align-items-center justify-content-between flex-wrap gap-2">
              <span style="display:inline-flex;align-items:center;gap:8px;padding:6px 12px;border-radius:999px;background: rgba(240,180,41,.95);color:#1b1b1b;font-weight:900;font-size:.85rem;">
                MSRIG
              </span>
              <span style="color: rgba(255,255,255,.85); font-weight: 700;">
                MSRIG Student Research Portal
              </span>
            </div>
            <p class="mb-0 mt-2" style="color: rgba(255,255,255,.85);">
              The Medical Student Research Interest Group connects students to active projects, mentors, and teams.
            </p>
          </div>
        </div>

      </div>
    </div>
  </div>
</section>

<!-- TOOLBAR (floating card) -->
<div class="container toolbar">
  <div class="panel">
    <form method="get" class="row g-2 align-items-center">
      <div class="col-md-7">
        <input class="form-control" name="q" value="{{ q }}" placeholder="Search titles or summaries...">
      </div>

      <div class="col-md-3">
        <select class="form-select" name="status">
          <option value="">Any status</option>
          <option value="OPEN" {% if status == "OPEN" %}selected{% endif %}>Open</option>
          <option value="INPROG" {% if status == "INPROG" %}selected{% endif %}>In Progress</option>
          <option value="CLOSED" {% if status == "CLOSED" %}selected{% endif %}>Closed</option>
        </select>
      </div>

      <div class="col-md-2 d-grid">
        <button type="submit" class="btn btn-gold">Search</button>
      </div>
  <!-- Tag filters (collapsible) -->
  <div class="mt-3">
    <div class="d-flex align-items-center justify-content-between">
      <button class="btn btn-outline-secondary"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#tagFilters"
              aria-expanded="false"
              aria-controls="tagFilters"
              style="border-radius:12px;font-weight:900;">
        Filter by tags
        {% if selected_tags %}<span class="ms-2" style="font-weight:900;">({{ selected_tags|length }} selected)</span>{% endif %}
      </button>

      <a href="{% url 'home' %}" class="text-muted" style="font-weight:800; text-decoration:none;">Clear</a>
    </div>

    <div class="collapse mt-3 {% if selected_tags %}show{% endif %}" id="tagFilters">
      <div class="card" style="border-radius:16px;">
        <div class="card-body" style="padding:16px 16px 14px;">
          <div class="text-muted mb-2" style="font-weight:800;">Click to select. You can choose multiple.</div>

          <div class="tag-grid">
            {% for t in all_tags %}
              <input class="btn-check" type="checkbox" name="tags" value="{{ t.slug }}" id="tag-{{ t.slug }}"
                     {% if t.slug in selected_tags %}checked{% endif %}>
              <label class="tag-pill" for="tag-{{ t.slug }}">{{ t.name }}</label>
            {% endfor %}
          </div>

          <div class="d-flex gap-2 justify-content-end mt-3">
            <button class="btn btn-outline-secondary" style="border-radius:12px;font-weight:900;" type="submit">
              Apply
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>


</form>
  </div>
</div>

<!-- PROPOSAL GRID -->
<div class="container my-4">
  <div class="row g-4">
    {% for p in proposals %}
      <div class="col-md-6 col-lg-4">
        <div class="proposal-card h-100">
          <div class="card-body d-flex flex-column">

            <!-- Status + signups -->
            <div class="d-flex align-items-center justify-content-between mb-2">
              {% if p.status == "OPEN" %}
                <span class="badge-status badge-open">OPEN</span>
              {% elif p.status == "INPROG" %}
                <span class="badge-status badge-inprog">IN PROGRESS</span>
              {% else %}
                <span class="badge-status badge-closed">CLOSED</span>
              {% endif %}
              <span class="text-muted" style="font-weight:700;font-size:.85rem;">
                {{ p.signups_count }} signup{{ p.signups_count|pluralize }}
              </span>
            </div>

            <!-- Title + summary -->
            <h5 class="mt-3 mb-2" style="font-weight:900;">
              <a href="{% url 'proposal_detail' p.slug %}" style="text-decoration:none;color:inherit;">
                {{ p.title }}
              </a>
            </h5>
            <p class="text-muted mb-3">
              {{ p.summary|truncatechars:220 }}
            </p>

            <!-- Meta -->
            <div class="mt-auto pt-2 d-flex justify-content-between align-items-center">
              <span class="text-muted" style="font-size:.85rem;">
                Posted by {{ p.created_by_name }}
              </span>
              <span class="text-muted" style="font-size:.85rem;">
                {{ p.created_at|date:"M j, Y" }}
              </span>
            </div>

            <div class="mt-3">
              <a class="btn btn-sm btn-outline-secondary" href="{% url 'proposal_detail' p.slug %}" style="font-weight:800;border-radius:10px;">
                View Details
              </a>
            </div>

          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12">
        <div class="p-4 text-center" style="background:white;border:1px solid rgba(0,0,0,.06);border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.06);">
          <p class="text-muted mb-0">No proposals yet. Someone be the hero.</p>
        </div>
      </div>
    {% endfor %}
  </div>

  <!-- Authorship / contact (cleaner, less “big card”) -->
  <div class="mt-5 p-4" style="background:white;border:1px solid rgba(0,0,0,.06);border-radius:16px;box-shadow:0 10px 25px rgba(0,0,0,.06);">
    <div class="row g-3 align-items-center">
      <div class="col-lg-8">
        <div style="font-weight:900;">Website created by</div>
        <div class="text-muted">
          Andrew Daigle · Wesley Jameson · Bailey Lupo · Christian Quinones
        </div>
      </div>
      <div class="col-lg-4 text-lg-end">
        <div class="text-muted" style="font-weight:800;">
          Questions? Email
          <a href="mailto:msrig@lsuhs.edu" style="color: var(--msrig-purple); font-weight: 900; text-decoration:none;">
            msrig@lsuhs.edu
          </a>
        </div>
      </div>
    </div>
  </div>

</div>

{% endblock %}
