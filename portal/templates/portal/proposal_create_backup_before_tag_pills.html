{% extends "portal/base.html" %}
{% load widget_tweaks %}

{% block content %}

<div class="hero">
  <div class="container">
    <h1 class="mb-2" style="font-weight: 900;">Submit a Proposal</h1>
    <div class="text-light" style="opacity:.95; font-weight:700;">
      Share your project, recruit collaborators, and build something publishable.
    </div>
  </div>
</div>

<div class="surface">
  <div class="container" style="max-width: 920px;">
    <div class="card shadow-sm" style="border-radius: 18px;">
      <div class="card-body" style="padding: 28px;">
        <form method="post" novalidate>
          {% csrf_token %}

          {# ------------------ Tags (custom UI) ------------------ #}
          {% if form.tags %}
            <div class="mb-4">
              <label class="form-label" style="font-weight:900;">Specialties / Tags</label>
              <div class="text-muted mb-2" style="font-weight:700; font-size:.9rem;">
                Click to select all that apply.
              </div>

              <div class="tag-grid">
                {% for cb in form.tags %}
                  <input
                    type="checkbox"
                    class="btn-check"
                    id="{{ cb.id_for_label }}"
                    name="{{ cb.data.name }}"
                    value="{{ cb.data.value }}"
                    {% if cb.data.selected %}checked{% endif %}
                  >
                  <label class="tag-pill" for="{{ cb.id_for_label }}">{{ cb.choice_label }}</label>
                {% endfor %}
              </div>

              {% if form.tags.errors %}
                <div class="text-danger small mt-2" style="font-weight:700;">
                  {{ form.tags.errors|striptags }}
                </div>
              {% endif %}
            </div>
          {% endif %}

          {# ------------------ All other fields ------------------ #}
          {% for field in form %}
            {% if field.name != "tags" %}
              <div class="mb-3">
                <label class="form-label" for="{{ field.id_for_label }}" style="font-weight:800;">
                  {{ field.label }}
                </label>

                {% if field.errors %}
                  {{ field|add_class:"form-control is-invalid" }}
                  <div class="invalid-feedback">{{ field.errors|striptags }}</div>
                {% else %}
                  {{ field|add_class:"form-control" }}
                {% endif %}

                {% if field.help_text %}
                  <div class="form-text">{{ field.help_text }}</div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}

          <hr class="my-4">

          {# ------------------ Optional question formset ------------------ #}
          {% if qset %}
            <div class="mb-3">
              <div style="font-weight:900; font-size:1.05rem;">Application Questions (optional)</div>
              <div class="text-muted" style="font-weight:700; font-size:.9rem;">
                Add prompts volunteers will answer when signing up.
              </div>
            </div>

            {{ qset.management_form }}

            <div class="vstack gap-3">
              {% for f in qset %}
                <div class="p-3" style="border:1px solid #e9ecef; border-radius:14px; background:#fff;">
                  <div class="mb-2">
                    <label class="form-label" style="font-weight:800;">Question</label>
                    {{ f.prompt|add_class:"form-control" }}
                    {% if f.prompt.errors %}
                      <div class="text-danger small mt-1">{{ f.prompt.errors|striptags }}</div>
                    {% endif %}
                  </div>

                  <div class="d-flex flex-wrap gap-3 align-items-center">
                    <div class="form-check">
                      {{ f.is_required|add_class:"form-check-input" }}
                      <label class="form-check-label" style="font-weight:700;">
                        Required
                      </label>
                    </div>

                    <div class="form-check">
                      {{ f.DELETE|add_class:"form-check-input" }}
                      <label class="form-check-label text-danger" style="font-weight:700;">
                        Remove
                      </label>
                    </div>
                  </div>
                </div>
              {% endfor %}
            </div>
          {% endif %}

          <div class="d-flex gap-2 justify-content-end mt-4">
            <a href="{% url 'home' %}" class="btn btn-outline-secondary" style="border-radius:12px;font-weight:800;">
              Cancel
            </a>
            <button type="submit" class="btn btn-gold">
              Create Proposal
            </button>
          </div>

        </form>
      </div>
    </div>

    <div class="text-center text-muted mt-3" style="font-weight:700;">
      Tip: Strong summaries recruit faster than “TBD” (science is cruel like that).
    </div>

  </div>
</div>

{% endblock %}
